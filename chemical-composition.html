<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cement Chemical Composition Calculator</title>
    <link rel="stylesheet" href="./style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Additional custom styles for chemical composition calculator */
        .kpi-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }
        
        .kpi-value {
            font-size: 28px;
            font-weight: bold;
            margin: 10px 0;
            color: var(--primary-color);
        }
        
        .kpi-label {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .good { color: var(--success-color); }
        .fair { color: var(--warning-color); }
        .poor { color: var(--danger-color); }
        
        .chart-container {
            height: 400px;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            padding: 15px;
            border: 1px solid var(--border-color);
        }
        
        .recommendations {
            background: #fff9e6;
            border-left: 5px solid var(--warning-color);
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
        }
        
        .ai-analysis {
            background: #f0f8ff;
            border-left: 5px solid var(--primary-color);
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
        }
        
        .results-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        /* Splash Screen Styles */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: var(--gradient-primary);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 1000;
            opacity: 1;
            transition: opacity 1s ease-out;
        }
        
        .splash-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .splash-screen h1 {
            font-size: 36px;
            margin-bottom: 10px;
            font-weight: 600;
            text-align: center;
        }
        
        .splash-screen p {
            font-size: 18px;
            font-style: italic;
            text-align: center;
        }
        
        .splash-screen .loader {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-top: 30px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Print Header and Footer */
        .print-header {
            display: none;
        }
        
        .print-footer {
            display: none;
        }
        
        @media print {
            @page {
                size: A4;
                margin: 0.75in;
            }
            
            .print-header, .print-footer {
                display: block;
                position: fixed;
                left: 0;
                right: 0;
                background: white;
                z-index: 100;
                padding: 10px 0.75in;
            }
            
            .print-header {
                top: 0;
                height: 70px;
                border-bottom: 2px solid var(--primary-color);
                display: flex;
                justify-content: space-between;
                align-items: center;
                font-size: 10pt;
            }
            
            .print-footer {
                bottom: 0;
                height: 30px;
                border-top: 1px solid var(--border-color);
                text-align: center;
                font-size: 9pt;
                color: var(--text-secondary);
                line-height: 30px;
            }
            
            body {
                padding-top: 80px;
                padding-bottom: 40px;
                font-size: 12pt;
            }
            
            .no-print {
                display: none !important;
            }
            
            .card {
                box-shadow: none;
                border: 1px solid var(--border-color);
                page-break-inside: avoid;
            }
            
            .chart-container {
                page-break-inside: avoid;
            }
        }
        
        /* Custom styles for this calculator */
        .developer-info {
            background: var(--gradient-primary);
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin: 20px 0;
        }
        
        .developer-info h3 {
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .developer-info p {
            margin: 5px 0;
            font-size: 14px;
        }
        
        .api-status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
        }
        
        .api-status.connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .api-status.disconnected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <!-- Splash Screen -->
    <div id="splash-screen" class="splash-screen">
        <div>
            <h1 data-en="Cement Chemical Composition Calculator" data-ar="حاسبة التركيب الكيميائي للأسمنت">Cement Chemical Composition Calculator</h1>
            <p data-en="Developed by: Mr. Fadi M. Darwesh" data-ar="تطوير: السيد فادي م. درويش">Developed by: Mr. Fadi M. Darwesh</p>
            <p data-en="QC & R&D Specialist" data-ar="أخصائي ضمان الجودة والبحوث والتطوير">QC & R&D Specialist</p>
            <p data-en="asrar.cement@gmail.com" data-ar="asrar.cement@gmail.com">asrar.cement@gmail.com</p>
            <div class="loader"></div>
        </div>
    </div>

    <!-- Print Header -->
    <div class="print-header">
        <div>
            <strong data-en="Cement Chemical Composition Calculator" data-ar="حاسبة التركيب الكيميائي للأسمنت">Cement Chemical Composition Calculator</strong>
        </div>
        <div>
            <strong data-en="Confidential Report" data-ar="تقرير سري">Confidential Report</strong>
        </div>
    </div>

    <!-- Print Footer -->
    <div class="print-footer">
        <span data-en="Mr. Fadi M. Darwesh - QC & R&D Specialist - asrar.cement@gmail.com" data-ar="السيد فادي م. درويش - أخصائي ضمان الجودة والبحوث والتطوير - asrar.cement@gmail.com">Mr. Fadi M. Darwesh - QC & R&D Specialist - asrar.cement@gmail.com</span>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header no-print">
            <div class="header-content">
                <div class="logo">
                    <h1 data-en="Cement Chemical Composition Calculator" data-ar="حاسبة التركيب الكيميائي للأسمنت">Cement Chemical Composition Calculator</h1>
                </div>
                <div class="header-controls">
                    <div class="language-switch">
                        <button class="lang-btn active" id="lang-en">English</button>
                        <button class="lang-btn" id="lang-ar">العربية</button>
                    </div>
                </div>
            </div>
        <a href="index.html" class="back-btn" style="position: fixed; top: 20px; right: 20px; background: var(--secondary); color: white; padding: 12px 24px; border: none; border-radius: 25px; cursor: pointer; font-weight: 600; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; transition: all 0.3s; z-index: 100;"><i class="fas fa-arrow-right"></i>العودة للرئيسية</a>
</header>

        <div class="main-content">
            <!-- Hero Section -->
            <section class="hero-section">
                <div class="hero-content">
                    <h2 data-en="Advanced Chemical Composition Calculator" data-ar="حاسبة التركيب الكيميائي المتقدمة">Advanced Chemical Composition Calculator</h2>
                    <p data-en="Comprehensive analysis tool for cement chemical composition evaluation using Bogue calculations and industry-standard quality indices" data-ar="أداة شاملة لتحليل التركيب الكيميائي للأسمنت باستخدام حسابات بوج والمؤشرات القياسية للصناعة">Comprehensive analysis tool for cement chemical composition evaluation using Bogue calculations and industry-standard quality indices</p>
                </div>
            </section>

            <!-- Company & Report Information -->
            <div class="card">
                <h2 class="section-title" data-en="Company & Report Information" data-ar="معلومات الشركة والتقرير">Company & Report Information</h2>
                <div class="grid-2" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="input-group">
                        <label for="company-name" data-en="Company Name" data-ar="اسم الشركة">Company Name</label>
                        <input type="text" id="company-name" placeholder="Enter company name">
                    </div>
                    <div class="input-group">
                        <label for="report-date" data-en="Report Date" data-ar="تاريخ التقرير">Report Date</label>
                        <input type="date" id="report-date">
                    </div>
                    <div class="input-group">
                        <label for="report-preparer" data-en="Report Prepared By" data-ar="معد التقرير">Report Prepared By</label>
                        <input type="text" id="report-preparer" placeholder="Enter preparer name">
                    </div>
                    <div class="input-group">
                        <label for="report-position" data-en="Preparer Position" data-ar="منصب معد التقرير">Preparer Position</label>
                        <input type="text" id="report-position" placeholder="Enter preparer position">
                    </div>
                    <div class="input-group">
                        <label for="product-type" data-en="Product Type" data-ar="نوع المنتج">Product Type</label>
                        <input type="text" id="product-type" placeholder="e.g., OPC, PPC, etc.">
                    </div>
                    <div class="input-group">
                        <label for="production-date" data-en="Production Date" data-ar="تاريخ الإنتاج">Production Date</label>
                        <input type="date" id="production-date">
                    </div>
                </div>
            </div>

            <!-- Chemical Composition Parameters -->
            <div class="card">
                <h2 class="section-title" data-en="Chemical Composition Parameters" data-ar="معاملات التركيب الكيميائي">Chemical Composition Parameters</h2>
                <div class="grid-3" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                    <div class="input-group">
                        <label for="sio2" data-en="SiO₂ (%)" data-ar="SiO₂ (%)">SiO₂ (%)</label>
                        <input type="number" id="sio2" placeholder="Enter SiO₂ percentage" step="0.01" min="0" max="100">
                    </div>
                    <div class="input-group">
                        <label for="al2o3" data-en="Al₂O₃ (%)" data-ar="Al₂O₃ (%)">Al₂O₃ (%)</label>
                        <input type="number" id="al2o3" placeholder="Enter Al₂O₃ percentage" step="0.01" min="0" max="100">
                    </div>
                    <div class="input-group">
                        <label for="fe2o3" data-en="Fe₂O₃ (%)" data-ar="Fe₂O₃ (%)">Fe₂O₃ (%)</label>
                        <input type="number" id="fe2o3" placeholder="Enter Fe₂O₃ percentage" step="0.01" min="0" max="100">
                    </div>
                    <div class="input-group">
                        <label for="cao" data-en="CaO (%)" data-ar="CaO (%)">CaO (%)</label>
                        <input type="number" id="cao" placeholder="Enter CaO percentage" step="0.01" min="0" max="100">
                    </div>
                    <div class="input-group">
                        <label for="mgo" data-en="MgO (%)" data-ar="MgO (%)">MgO (%)</label>
                        <input type="number" id="mgo" placeholder="Enter MgO percentage" step="0.01" min="0" max="100">
                    </div>
                    <div class="input-group">
                        <label for="so3" data-en="SO₃ (%)" data-ar="SO₃ (%)">SO₃ (%)</label>
                        <input type="number" id="so3" placeholder="Enter SO₃ percentage" step="0.01" min="0" max="100">
                    </div>
                    <div class="input-group">
                        <label for="loi" data-en="Loss on Ignition (%)" data-ar="فقدان الاشتعال (%)">Loss on Ignition (%)</label>
                        <input type="number" id="loi" placeholder="Enter LOI percentage" step="0.01" min="0" max="100">
                    </div>
                </div>
            </div>

            <!-- Target Settings -->
            <div class="card">
                <h2 class="section-title" data-en="Target Settings" data-ar="إعدادات الأهداف">Target Settings</h2>
                <p style="text-align: center; color: var(--text-secondary); margin-bottom: 15px;" data-en="Set your factory's specific targets for quality evaluation." data-ar="حدد أهداف مصنعك الخاصة للتقييم.">Set your factory's specific targets for quality evaluation.</p>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th data-en="Parameter" data-ar="المعامل">Parameter</th>
                            <th data-en="Target Value" data-ar="القيمة المستهدفة">Target Value</th>
                            <th data-en="Range (±)" data-ar="النطاق (±)">Range (±)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td data-en="Target Lime Saturation Factor" data-ar="عامل تشبع الجير المستهدف">Target Lime Saturation Factor</td>
                            <td><input type="number" id="target-lsf" value="0.95" step="0.01"></td>
                            <td><input type="number" id="target-lsf-range" value="0.05" step="0.01"></td>
                        </tr>
                        <tr>
                            <td data-en="Target Silica Ratio" data-ar="النسبة السيليسية المستهدفة">Target Silica Ratio</td>
                            <td><input type="number" id="target-sr" value="2.5" step="0.1"></td>
                            <td><input type="number" id="target-sr-range" value="0.3" step="0.1"></td>
                        </tr>
                        <tr>
                            <td data-en="Target Alumina Ratio" data-ar="النسبة الألومينية المستهدفة">Target Alumina Ratio</td>
                            <td><input type="number" id="target-ar" value="1.5" step="0.1"></td>
                            <td><input type="number" id="target-ar-range" value="0.2" step="0.1"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Raw Material Composition -->
            <div class="card">
                <h2 class="section-title" data-en="Raw Material Composition" data-ar="تركيبة المواد الخام">Raw Material Composition</h2>
                <table class="data-table" id="raw-material-table">
                    <thead>
                        <tr>
                            <th data-en="Raw Material" data-ar="المادة الخام">Raw Material</th>
                            <th data-en="SiO₂ (%)" data-ar="SiO₂ (%)">SiO₂ (%)</th>
                            <th data-en="Al₂O₃ (%)" data-ar="Al₂O₃ (%)">Al₂O₃ (%)</th>
                            <th data-en="Fe₂O₃ (%)" data-ar="Fe₂O₃ (%)">Fe₂O₃ (%)</th>
                            <th data-en="CaO (%)" data-ar="CaO (%)">CaO (%)</th>
                            <th data-en="Actions" data-ar="الإجراءات">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="raw-material-table-body">
                    </tbody>
                </table>
                
                <div class="button-group">
                    <button class="btn btn-primary" id="add-raw-material" data-en="Add Raw Material" data-ar="إضافة مادة خام">Add Raw Material</button>
                    <button class="btn btn-warning" id="load-example-raw" data-en="Load Example Data" data-ar="تحميل بيانات مثال">Load Example Data</button>
                    <button class="btn btn-success" id="save-raw-data" data-ar="حفظ البيانات" data-en="Save Data">Save Data</button>
                    <button class="btn btn-secondary" id="load-raw-data" data-en="Load Data" data-ar="تحميل البيانات">Load Data</button>
                    <button class="btn btn-lg btn-primary" id="calculate-btn" data-en="Calculate Composition" data-ar="حساب التركيب">Calculate Composition</button>
                </div>
            </div>

            <!-- Process Parameters -->
            <div class="card">
                <h2 class="section-title" data-en="Process Parameters" data-ar="معاملات العملية">Process Parameters</h2>
                <div class="grid-3" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                    <div class="input-group">
                        <label for="kiln-inlet-temp" data-en="Kiln Inlet Temperature (°C)" data-ar="درجة حرارة مدخل الفرن (°م)">Kiln Inlet Temperature (°C)</label>
                        <input type="number" id="kiln-inlet-temp" placeholder="Enter temperature" step="1">
                    </div>
                    <div class="input-group">
                        <label for="burn-zone-temp" data-en="Burn Zone Temperature (°C)" data-ar="درجة حرارة منطقة الحرق (°م)">Burn Zone Temperature (°C)</label>
                        <input type="number" id="burn-zone-temp" placeholder="Enter temperature" step="1">
                    </div>
                    <div class="input-group">
                        <label for="preheater-temp" data-en="Preheater Exit Temperature (°C)" data-ar="درجة حرارة مخرج المسبق التسخين (°م)">Preheater Exit Temperature (°C)</label>
                        <input type="number" id="preheater-temp" placeholder="Enter temperature" step="1">
                    </div>
                    <div class="input-group">
                        <label for="coal-consumption" data-en="Coal Consumption (kg/ton)" data-ar="استهلاك الفحم (كجم/طن)">Coal Consumption (kg/ton)</label>
                        <input type="number" id="coal-consumption" placeholder="Enter consumption" step="0.1">
                    </div>
                    <div class="input-group">
                        <label for="free-lime" data-en="Free Lime (%)" data-ar="الجير الحر (%)">Free Lime (%)</label>
                        <input type="number" id="free-lime" placeholder="Enter percentage" step="0.01">
                    </div>
                    <div class="input-group">
                        <label for="fineness" data-en="Fineness (m²/kg)" data-ar="النعومة (م²/كجم)">Fineness (m²/kg)</label>
                        <input type="number" id="fineness" placeholder="Enter fineness" step="1">
                    </div>
                </div>
            </div>

            <!-- Quality Control Data -->
            <div class="card">
                <h2 class="section-title" data-en="Quality Control Data" data-ar="بيانات ضبط الجودة">Quality Control Data</h2>
                <table class="data-table" id="qc-table">
                    <thead>
                        <tr>
                            <th data-en="Test Parameter" data-ar="معامل الاختبار">Test Parameter</th>
                            <th data-en="Result" data-ar="النتيجة">Result</th>
                            <th data-en="Standard" data-ar="المعيار">Standard</th>
                            <th data-en="Unit" data-ar="الوحدة">Unit</th>
                        </tr>
                    </thead>
                    <tbody id="qc-table-body">
                    </tbody>
                </table>
                
                <div class="button-group">
                    <button class="btn btn-primary" id="add-qc-parameter" data-en="Add QC Parameter" data-ar="إضافة معامل ضبط جودة">Add QC Parameter</button>
                </div>
            </div>

            <!-- Advanced AI Analysis -->
            <div class="card">
                <h2 class="section-title" data-en="Advanced AI Analysis" data-ar="التحليل المتقدم بالذكاء الاصطناعي">Advanced AI Analysis</h2>
                
                <div id="api-status" class="api-status disconnected" data-en="API: Disconnected" data-ar="API: غير متصل">
                    API: Disconnected
                </div>
                
                <div class="grid-2" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="input-group">
                        <label for="api-key" data-en="OpenAI API Key" data-ar="مفتاح OpenAI API">OpenAI API Key</label>
                        <input type="password" id="api-key" placeholder="Enter your OpenAI API key">
                        <small style="color: var(--text-secondary); display: block; margin-top: 5px;" data-en="Get your API key from https://platform.openai.com" data-ar="احصل على المفتاح من https://platform.openai.com">Get your API key from https://platform.openai.com</small>
                    </div>
                    <div class="input-group">
                        <label for="api-model" data-en="AI Model" data-ar="نموذج الذكاء الاصطناعي">AI Model</label>
                        <select id="api-model">
                            <option value="gpt-3.5-turbo">GPT-3.5 Turbo (Fast & Cost-effective)</option>
                            <option value="gpt-4">GPT-4 (Most Advanced)</option>
                        </select>
                    </div>
                </div>
                
                <div class="button-group">
                    <button class="btn btn-secondary" id="test-api" data-en="Test API Connection" data-ar="اختبار اتصال API">Test API Connection</button>
                    <button class="btn btn-primary" id="ai-analysis-btn" data-en="Get AI Analysis" data-ar="الحصول على تحليل الذكاء الاصطناعي">Get AI Analysis</button>
                    <button class="btn btn-success" id="save-api-key" data-en="Save API Key" data-ar="حفظ المفتاح">Save API Key</button>
                </div>
            </div>

            <!-- Additional Notes -->
            <div class="card">
                <h2 class="section-title" data-en="Additional Notes" data-ar="ملاحظات إضافية">Additional Notes</h2>
                <div class="input-group">
                    <label for="additional-notes" data-en="Add your notes and observations here:" data-ar="أضف ملاحظاتك وتوصياتك هنا:">Add your notes and observations here:</label>
                    <textarea id="additional-notes" rows="4" style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 16px; font-family: var(--font-arabic);" placeholder="Enter any additional notes, observations, or recommendations..."></textarea>
                </div>
                <small style="color: var(--text-secondary);" data-en="These notes will be included in the final report" data-ar="هذه الملاحظات ستظهر في التقرير النهائي">These notes will be included in the final report</small>
            </div>
            
            <!-- Results Section -->
            <div class="results-section" id="results-section">
                <div class="card">
                    <h2 class="section-title" data-en="Chemical Composition Results" data-ar="نتائج التركيب الكيميائي">Chemical Composition Results</h2>
                    
                    <!-- Phase Composition KPIs -->
                    <h3 class="section-heading" data-en="Clinker Phase Composition (Bogue Calculation)" data-ar="تركيب مراحل الكلنكر (حساب بوج)">Clinker Phase Composition (Bogue Calculation)</h3>
                    <div class="grid-4" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
                        <div class="kpi-card">
                            <div class="kpi-label" data-en="C₃S (Alite)" data-ar="C₃S (ألبيت)">C₃S (Alite)</div>
                            <div class="kpi-value" id="C3S-value">-</div>
                            <div class="kpi-label">%</div>
                            <div class="kpi-desc" style="font-size: 10px; color: var(--text-secondary); margin-top: 5px;" data-en="Tricalcium silicate - Primary strength phase" data-ar="سيليكات ثلاثي الكالسيوم - مرحلة القوة الأساسية">Tricalcium silicate - Primary strength phase</div>
                        </div>
                        
                        <div class="kpi-card">
                            <div class="kpi-label" data-en="C₂S (Belite)" data-ar="C₂S (بليت)">C₂S (Belite)</div>
                            <div class="kpi-value" id="C2S-value">-</div>
                            <div class="kpi-label">%</div>
                            <div class="kpi-desc" style="font-size: 10px; color: var(--text-secondary); margin-top: 5px;" data-en="Dicalcium silicate - Late strength phase" data-ar="سيليكات ثنائي الكالسيوم - مرحلة القوة المتأخرة">Dicalcium silicate - Late strength phase</div>
                        </div>
                        
                        <div class="kpi-card">
                            <div class="kpi-label" data-en="C₃A (Celite)" data-ar="C₃A (سيليت)">C₃A (Celite)</div>
                            <div class="kpi-value" id="C3A-value">-</div>
                            <div class="kpi-label">%</div>
                            <div class="kpi-desc" style="font-size: 10px; color: var(--text-secondary); margin-top: 5px;" data-en="Tricalcium aluminate - Controls setting time" data-ar="ألومينات ثلاثي الكالسيوم - يتحكم في زمن التصلب">Tricalcium aluminate - Controls setting time</div>
                        </div>
                        
                        <div class="kpi-card">
                            <div class="kpi-label" data-en="C₄AF (Ferrite)" data-ar="C₄AF (فيريت)">C₄AF (Ferrite)</div>
                            <div class="kpi-value" id="C4AF-value">-</div>
                            <div class="kpi-label">%</div>
                            <div class="kpi-desc" style="font-size: 10px; color: var(--text-secondary); margin-top: 5px;" data-en="Tetracalcium aluminoferrite - Minor phase" data-ar="ألومينوفيريت رباعي الكالسيوم - مرحلة ثانوية">Tetracalcium aluminoferrite - Minor phase</div>
                        </div>
                    </div>

                    <!-- Quality Indices -->
                    <h3 class="section-heading" data-en="Quality Indices" data-ar="مؤشرات الجودة">Quality Indices</h3>
                    <div class="grid-4" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <!-- KPI Cards -->
                        <div class="kpi-card">
                            <div class="kpi-label" data-en="Lime Saturation Factor" data-ar="عامل تشبع الجير">Lime Saturation Factor</div>
                            <div class="kpi-value" id="lsf-value">-</div>
                            <div class="kpi-label" id="lsf-status">-</div>
                            <div class="kpi-desc" style="font-size: 11px; color: var(--text-secondary); margin-top: 8px; line-height: 1.4;" data-en="The LSF indicates the proportion of available CaO to form C₃S. Typical range: 0.85-1.02." data-ar="LSF يشير إلى نسبة CaO المتاح لتشكيل C₃S. النطاق النموذجي: 0.85-1.02."></div>
                        </div>
                        
                        <div class="kpi-card">
                            <div class="kpi-label" data-en="Silica Ratio" data-ar="النسبة السيليسية">Silica Ratio</div>
                            <div class="kpi-value" id="sr-value">-</div>
                            <div class="kpi-label" id="sr-status">-</div>
                            <div class="kpi-desc" style="font-size: 11px; color: var(--text-secondary); margin-top: 8px; line-height: 1.4;" data-en="SR = SiO₂/(Al₂O₃ + Fe₂O₃). Higher values indicate slower setting and lower heat of hydration." data-ar="SR = SiO₂/(Al₂O₃ + Fe₂O₃). القيم الأعلى تشير إلى تماسك أبطأ وحرارة أقل للترطيب."></div>
                        </div>
                        
                        <div class="kpi-card">
                            <div class="kpi-label" data-en="Alumina Ratio" data-ar="النسبة الألومينية">Alumina Ratio</div>
                            <div class="kpi-value" id="ar-value">-</div>
                            <div class="kpi-label" id="ar-status">-</div>
                            <div class="kpi-desc" style="font-size: 11px; color: var(--text-secondary); margin-top: 8px; line-height: 1.4;" data-en="AR = Al₂O₃/Fe₂O₃. Controls the formation of calcium aluminate phases." data-ar="AR = Al₂O₃/Fe₂O₃. يتحكم في تكوين مراحل الألومينات."></div>
                        </div>
                        
                        <div class="kpi-card">
                            <div class="kpi-label" data-en="Quality Index" data-ar="مؤشر الجودة">Quality Index</div>
                            <div class="kpi-value" id="qi-value">-</div>
                            <div class="kpi-label" id="qi-status">-</div>
                            <div class="kpi-desc" style="font-size: 11px; color: var(--text-secondary); margin-top: 8px; line-height: 1.4;" data-en="Composite index combining all quality parameters for overall assessment." data-ar="مؤشر مركب يجمع جميع معاملات الجودة للتقييم الشامل."></div>
                        </div>
                    </div>
                    
                    <!-- Charts -->
                    <div class="chart-container">
                        <canvas id="composition-chart"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="bogue-chart"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="kpi-chart"></canvas>
                    </div>
                    
                    <!-- Detailed Calculations -->
                    <div class="report-section">
                        <h3 class="section-heading" data-en="Detailed Calculations" data-ar="الحسابات التفصيلية">Detailed Calculations</h3>
                        <div id="detailed-calculations"></div>
                    </div>
                    
                    <!-- AI Analysis -->
                    <div class="ai-analysis" id="ai-analysis-container">
                        <h3 class="section-heading" data-en="AI Analysis" data-ar="تحليل الذكاء الاصطناعي">AI Analysis</h3>
                        <div id="ai-analysis-content">
                            <p data-en="No AI analysis available yet. Click 'Get AI Analysis' to generate." data-ar="لا يوجد تحليل بالذكاء الاصطناعي بعد. انقر على 'الحصول على تحليل الذكاء الاصطناعي' لإنشائه.">No AI analysis available yet. Click 'Get AI Analysis' to generate.</p>
                        </div>
                    </div>
                    
                    <!-- Recommendations -->
                    <div class="recommendations">
                        <h3 class="section-heading" data-en="Recommendations" data-ar="التوصيات">Recommendations</h3>
                        <div id="recommendations-content"></div>
                    </div>
                    
                    <div class="button-group no-print">
                        <button class="btn btn-success" id="print-report" data-en="Print Report" data-ar="طباعة التقرير">Print Report</button>
                        <button class="btn btn-warning" id="export-pdf" data-en="Export as PDF" data-ar="تصدير كـ PDF">Export as PDF</button>
                        <button class="btn btn-secondary" id="new-analysis" data-en="New Analysis" data-ar="تحليل جديد">New Analysis</button>
                    </div>
                </div>
            </div>

            <!-- Developer Information -->
            <div class="developer-info no-print">
                <h3 data-en="System Developer" data-ar="مطور النظام">System Developer</h3>
                <p><strong data-en="Mr. Fadi M. Darwesh" data-ar="السيد فادي م. درويش">Mr. Fadi M. Darwesh</strong></p>
                <p data-en="QC & R&D Specialist" data-ar="أخصائي ضمان الجودة والبحوث والتطوير">QC & R&D Specialist</p>
                <p>asrar.cement@gmail.com</p>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer no-print">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4 data-en="Chemical Composition Calculator" data-ar="حاسبة التركيب الكيميائي للأسمنت">Chemical Composition Calculator</h4>
                    <p data-en="Advanced calculation tools for cement chemical composition evaluation" data-ar="أدوات حساب متقدمة لتقييم التركيب الكيميائي للأسمنت">Advanced calculation tools for cement chemical composition evaluation</p>
                </div>
                <div class="footer-section">
                    <h4 data-en="Developer" data-ar="المطور">Developer</h4>
                    <ul>
                        <li>Mr. Fadi M. Darwesh</li>
                        <li data-en="QC & R&D Specialist" data-ar="أخصائي ضمان الجودة والبحوث والتطوير">QC & R&D Specialist</li>
                        <li>asrar.cement@gmail.com</li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4 data-en="Features" data-ar="المميزات">Features</h4>
                    <ul>
                        <li data-en="Bogue Calculations" data-ar="حسابات بوج">Bogue Calculations</li>
                        <li data-en="Quality Indices" data-ar="مؤشرات الجودة">Quality Indices</li>
                        <li data-en="AI-Powered Insights" data-ar="رؤى مدعومة بالذكاء الاصطناعي">AI-Powered Insights</li>
                        <li data-en="Professional Reports" data-ar="تقارير احترافية">Professional Reports</li>
                    </ul>
                </div>
            </div>
            <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--gray-700);">
                <p data-en="© 2025 Cement Chemical Composition Calculator. All rights reserved." data-ar="© 2025 نظام حاسبة التركيب الكيميائي للأسمنت. جميع الحقوق محفوظة.">© 2025 Cement Chemical Composition Calculator. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="loading-spinner">
            <i class="fas fa-cog"></i>
            <p data-en="Calculating..." data-ar="جاري الحساب...">Calculating...</p>
        </div>
    </div>

    <script>
        // Language switching functionality
        document.getElementById('lang-en').addEventListener('click', function() {
            setLanguage('en');
        });
        
        document.getElementById('lang-ar').addEventListener('click', function() {
            setLanguage('ar');
        });
        
        function setLanguage(lang) {
            // Update active button
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`lang-${lang}`).classList.add('active');
            
            // Update text content based on data attributes
            document.querySelectorAll('[data-en]').forEach(element => {
                if (lang === 'en') {
                    element.textContent = element.getAttribute('data-en');
                } else {
                    element.textContent = element.getAttribute('data-ar');
                }
            });
            
            // Update placeholders
            document.querySelectorAll('input[placeholder], textarea[placeholder]').forEach(element => {
                const enText = element.getAttribute('data-en-placeholder');
                const arText = element.getAttribute('data-ar-placeholder');
                
                if (enText && arText) {
                    element.placeholder = lang === 'en' ? enText : arText;
                }
            });
            
            // Update direction
            document.body.dir = lang === 'ar' ? 'rtl' : 'ltr';
        }
        
        // Initialize with English
        setLanguage('en');
        
        // Initialize splash screen
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                document.getElementById('splash-screen').classList.add('hidden');
            }, 2000);
            
            // Set current dates
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('report-date').value = today;
            document.getElementById('production-date').value = today;
            
            // Initialize with default raw materials
            addRawMaterialRow('Limestone');
            addRawMaterialRow('Sand');
            addRawMaterialRow('Clay');
            addRawMaterialRow('Iron Ore');
            
            // Initialize QC table
            addQCRow('Compressive Strength (3 days)', '22', '≥ 23', 'MPa');
            addQCRow('Compressive Strength (7 days)', '33', '≥ 33', 'MPa');
            addQCRow('Compressive Strength (28 days)', '53', '≥ 53', 'MPa');
            addQCRow('Setting Time (Initial)', '140', '≥ 45', 'min');
            addQCRow('Setting Time (Final)', '210', '≤ 600', 'min');
            addQCRow('Soundness', '2', '≤ 10', 'mm');
            
            // Load saved API key
            const savedApiKey = localStorage.getItem('composition_analyzer_api_key');
            if (savedApiKey) {
                document.getElementById('api-key').value = savedApiKey;
                updateApiStatus('connected', 'API: Connected (Using saved key)');
            }
        });

        function addRawMaterialRow(material = '') {
            const tableBody = document.getElementById('raw-material-table-body');
            const newRow = document.createElement('tr');
            
            newRow.innerHTML = `
                <td>
                    <input type="text" class="material-name" value="${material}" placeholder="Material name">
                </td>
                <td>
                    <input type="number" step="0.01" min="0" max="100" class="sio2-input" placeholder="0-100">
                </td>
                <td>
                    <input type="number" step="0.01" min="0" max="100" class="al2o3-input" placeholder="0-100">
                </td>
                <td>
                    <input type="number" step="0.01" min="0" max="100" class="fe2o3-input" placeholder="0-100">
                </td>
                <td>
                    <input type="number" step="0.01" min="0" max="100" class="cao-input" placeholder="0-100">
                </td>
                <td>
                    <button class="btn btn-danger remove-row" data-en="Remove" data-ar="إزالة">Remove</button>
                </td>
            `;
            
            tableBody.appendChild(newRow);
            
            newRow.querySelector('.remove-row').addEventListener('click', function() {
                if (tableBody.children.length > 1) {
                    tableBody.removeChild(newRow);
                } else {
                    alert('You must have at least one raw material!');
                }
            });
        }

        function addQCRow(parameter = '', result = '', standard = '', unit = '') {
            const tableBody = document.getElementById('qc-table-body');
            const newRow = document.createElement('tr');
            
            newRow.innerHTML = `
                <td>
                    <input type="text" class="qc-parameter" value="${parameter}" placeholder="Parameter name">
                </td>
                <td>
                    <input type="text" class="qc-result" value="${result}" placeholder="Result">
                </td>
                <td>
                    <input type="text" class="qc-standard" value="${standard}" placeholder="Standard">
                </td>
                <td>
                    <input type="text" class="qc-unit" value="${unit}" placeholder="Unit">
                </td>
            `;
            
            tableBody.appendChild(newRow);
        }

        function updateApiStatus(status, message) {
            const apiStatus = document.getElementById('api-status');
            apiStatus.className = `api-status ${status}`;
            apiStatus.textContent = message;
        }

        // Calculate composition
        document.getElementById('calculate-btn').addEventListener('click', function() {
            calculateComposition();
        });

        function calculateComposition() {
            // Collect chemical composition data
            const composition = {
                SiO2: parseFloat(document.getElementById('sio2').value) || 0,
                Al2O3: parseFloat(document.getElementById('al2o3').value) || 0,
                Fe2O3: parseFloat(document.getElementById('fe2o3').value) || 0,
                CaO: parseFloat(document.getElementById('cao').value) || 0,
                MgO: parseFloat(document.getElementById('mgo').value) || 0,
                SO3: parseFloat(document.getElementById('so3').value) || 0,
                LOI: parseFloat(document.getElementById('loi').value) || 0
            };
            
            // Validate input
            if (composition.SiO2 + composition.Al2O3 + composition.Fe2O3 + composition.CaO + composition.MgO + composition.SO3 + composition.LOI === 0) {
                alert('Please enter at least one chemical composition value!');
                return;
            }
            
            // Show loading
            document.getElementById('loading-overlay').classList.remove('hidden');
            
            // Simulate calculation delay
            setTimeout(() => {
                const results = performBogueCalculations(composition);
                
                if (!results) {
                    document.getElementById('loading-overlay').classList.add('hidden');
                    return;
                }
                
                document.getElementById('loading-overlay').classList.remove('hidden');
                displayResults(results);
                document.getElementById('results-section').style.display = 'block';
            }, 1000);
        }

        function performBogueCalculations(composition) {
            // Bogue calculations for clinker phases
            const C3S = 4.071 * composition.CaO - 7.6 * composition.SiO2 - 6.718 * composition.Al2O3 - 1.43 * composition.Fe2O3 - 2.852 * composition.SO3;
            const C2S = 2.867 * composition.SiO2 - 0.7544 * C3S;
            const C3A = 2.65 * composition.Al2O3 - 1.692 * composition.Fe2O3;
            const C4AF = 3.043 * composition.Fe2O3;
            
            // Quality indices
            const LSF = composition.CaO / (2.8 * composition.SiO2 + 1.18 * composition.Al2O3 + 0.65 * composition.Fe2O3);
            const SR = composition.SiO2 / (composition.Al2O3 + composition.Fe2O3);
            const AR = composition.Al2O3 / composition.Fe2O3;
            
            // Quality Index (composite score)
            const LSF_deviation = Math.abs(LSF - 0.95);
            const SR_deviation = Math.abs(SR - 2.5);
            const AR_deviation = Math.abs(AR - 1.5);
            const QualityIndex = Math.max(0, 100 - (LSF_deviation * 200 + SR_deviation * 50 + AR_deviation * 100));
            
            return {
                phases: {
                    C3S: Math.max(0, C3S),
                    C2S: Math.max(0, C2S),
                    C3A: Math.max(0, C3A),
                    C4AF: Math.max(0, C4AF)
                },
                indices: {
                    LSF: LSF,
                    SR: SR,
                    AR: AR,
                    QualityIndex: QualityIndex
                },
                composition: composition
            };
        }

        function setStatusIndicator(metric, value, goodThreshold, fairThreshold, lowerIsBetter = false) {
            const statusElement = document.getElementById(`${metric}-status`);
            let status, statusClass;
            
            if (value === null || typeof value === 'undefined' || isNaN(value)) {
                statusElement.textContent = 'N/A';
                statusElement.className = 'kpi-label';
                return;
            }

            if (lowerIsBetter) {
                if (value <= goodThreshold) {
                    status = 'Good';
                    statusClass = 'good';
                } else if (value <= fairThreshold) {
                    status = 'Fair';
                    statusClass = 'fair';
                } else {
                    status = 'Poor';
                    statusClass = 'poor';
                }
            } else {
                if (Math.abs(value - goodThreshold) <= Math.abs(value - (goodThreshold - 0.1))) {
                    status = 'Good';
                    statusClass = 'good';
                } else {
                    status = 'Fair';
                    statusClass = 'fair';
                }
            }
            
            statusElement.textContent = status;
            statusElement.className = 'kpi-label ' + statusClass;
        }

        function displayResults(results) {
            // Display phase composition
            document.getElementById('C3S-value').textContent = results.phases.C3S.toFixed(1) + '%';
            document.getElementById('C2S-value').textContent = results.phases.C2S.toFixed(1) + '%';
            document.getElementById('C3A-value').textContent = results.phases.C3A.toFixed(1) + '%';
            document.getElementById('C4AF-value').textContent = results.phases.C4AF.toFixed(1) + '%';
            
            // Display quality indices
            document.getElementById('lsf-value').textContent = results.indices.LSF.toFixed(3);
            document.getElementById('sr-value').textContent = results.indices.SR.toFixed(2);
            document.getElementById('ar-value').textContent = results.indices.AR.toFixed(2);
            document.getElementById('qi-value').textContent = results.indices.QualityIndex.toFixed(1) + '%';
            
            // Set status indicators
            const target_lsf = parseFloat(document.getElementById('target-lsf').value) || 0.95;
            const target_sr = parseFloat(document.getElementById('target-sr').value) || 2.5;
            const target_ar = parseFloat(document.getElementById('target-ar').value) || 1.5;
            
            setStatusIndicator('lsf', results.indices.LSF, target_lsf, target_lsf + 0.1, true);
            setStatusIndicator('sr', results.indices.SR, target_sr, target_sr + 0.5, true);
            setStatusIndicator('ar', results.indices.AR, target_ar, target_ar + 0.3, true);
            setStatusIndicator('qi', results.indices.QualityIndex, 85, 75, true);

            generateCharts(results);
            generateRecommendations(results);
        }

        function generateCharts(results) {
            // Composition Pie Chart
            const compCtx = document.getElementById('composition-chart').getContext('2d');
            
            if (window.compChart) {
                window.compChart.destroy();
            }
            
            window.compChart = new Chart(compCtx, {
                type: 'pie',
                data: {
                    labels: ['SiO₂', 'Al₂O₃', 'Fe₂O₃', 'CaO', 'MgO', 'SO₃', 'LOI'],
                    datasets: [{
                        data: [
                            results.composition.SiO2,
                            results.composition.Al2O3,
                            results.composition.Fe2O3,
                            results.composition.CaO,
                            results.composition.MgO,
                            results.composition.SO3,
                            results.composition.LOI
                        ],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.8)',
                            'rgba(54, 162, 235, 0.8)',
                            'rgba(255, 206, 86, 0.8)',
                            'rgba(75, 192, 192, 0.8)',
                            'rgba(153, 102, 255, 0.8)',
                            'rgba(255, 159, 64, 0.8)',
                            'rgba(199, 199, 199, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Chemical Composition Distribution'
                        },
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            
            // Bogue Phases Chart
            const bogueCtx = document.getElementById('bogue-chart').getContext('2d');
            
            if (window.bogueChart) {
                window.bogueChart.destroy();
            }
            
            window.bogueChart = new Chart(bogueCtx, {
                type: 'doughnut',
                data: {
                    labels: ['C₃S', 'C₂S', 'C₃A', 'C₄AF'],
                    datasets: [{
                        data: [
                            results.phases.C3S,
                            results.phases.C2S,
                            results.phases.C3A,
                            results.phases.C4AF
                        ],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.8)',
                            'rgba(54, 162, 235, 0.8)',
                            'rgba(255, 206, 86, 0.8)',
                            'rgba(75, 192, 192, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Bogue Phase Composition'
                        },
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // KPI Chart
            const kpiCtx = document.getElementById('kpi-chart').getContext('2d');
            if (window.kpiChart) {
                window.kpiChart.destroy();
            }
            
            const target_lsf = parseFloat(document.getElementById('target-lsf').value) || 0.95;
            const target_sr = parseFloat(document.getElementById('target-sr').value) || 2.5;
            const target_ar = parseFloat(document.getElementById('target-ar').value) || 1.5;
            const target_qi = 85;
            
            const kpiLabels = ['LSF', 'SR', 'AR', 'Quality Index'];
            const actualValues = [
                results.indices.LSF,
                results.indices.SR,
                results.indices.AR,
                results.indices.QualityIndex
            ];
            const goodValues = [target_lsf, target_sr, target_ar, target_qi];
            
            window.kpiChart = new Chart(kpiCtx, {
                type: 'bar',
                data: {
                    labels: kpiLabels,
                    datasets: [
                        {
                            label: 'Actual',
                            data: actualValues,
                            backgroundColor: 'rgba(37, 99, 235, 0.7)'
                        },
                        {
                            label: 'Target',
                            data: goodValues,
                            backgroundColor: 'rgba(16, 185, 129, 0.5)'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Value'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Quality Indices vs Targets'
                        }
                    }
                }
            });
        }

        function generateRecommendations(results) {
            let recommendations = '';
            
            const target_lsf = parseFloat(document.getElementById('target-lsf').value) || 0.95;
            const target_sr = parseFloat(document.getElementById('target-sr').value) || 2.5;
            const target_ar = parseFloat(document.getElementById('target-ar').value) || 1.5;

            if (results.indices.LSF > target_lsf + 0.1) {
                recommendations += `<p data-en="• Lime Saturation Factor is above target. Consider reducing CaO content or increasing silica ratio." data-ar="• عامل تشبع الجير أعلى من الهدف. فكر في تقليل محتوى CaO أو زيادة النسبة السيليسية.">• Lime Saturation Factor is above target. Consider reducing CaO content or increasing silica ratio.</p>`;
            }
            
            if (results.indices.LSF < target_lsf - 0.1) {
                recommendations += `<p data-en="• Lime Saturation Factor is below target. Increase CaO content or reduce acidic components." data-ar="• عامل تشبع الجير أقل من الهدف. زد محتوى CaO أو قلل المكونات الحمضية.">• Lime Saturation Factor is below target. Increase CaO content or reduce acidic components.</p>`;
            }
            
            if (results.indices.SR > target_sr + 0.5) {
                recommendations += `<p data-en="• Silica Ratio is high. Consider increasing Al₂O₃ or Fe₂O₃ content." data-ar="• النسبة السيليسية عالية. فكر في زيادة محتوى Al₂O₃ أو Fe₂O₃.">• Silica Ratio is high. Consider increasing Al₂O₃ or Fe₂O₃ content.</p>`;
            }
            
            if (results.indices.AR > target_ar + 0.3) {
                recommendations += `<p data-en="• Alumina Ratio is high. Consider adding iron correction or reducing Al₂O₃." data-ar="• النسبة الألومينية عالية. فكر في إضافة تصحيح الحديد أو تقليل Al₂O₃.">• Alumina Ratio is high. Consider adding iron correction or reducing Al₂O₃.</p>`;
            }
            
            recommendations += '<p data-en="• Monitor raw material variability and adjust kiln operation accordingly." data-ar="• راقب تغير المواد الخام واضبط تشغيل الفرن وفقاً لذلك.">• Monitor raw material variability and adjust kiln operation accordingly.</p>';
            recommendations += '<p data-en="• Regular chemical analysis ensures consistent product quality." data-ar="• التحليل الكيميائي المنتظم يضمن جودة المنتج المتناسقة.">• Regular chemical analysis ensures consistent product quality.</p>';
            
            document.getElementById('recommendations-content').innerHTML = recommendations;
        }
        
        // Button event listeners
        document.getElementById('add-raw-material').addEventListener('click', function() {
            addRawMaterialRow();
        });
        
        document.getElementById('add-qc-parameter').addEventListener('click', function() {
            addQCRow();
        });
        
        document.getElementById('print-report').addEventListener('click', function() {
            window.print();
        });
        
        document.getElementById('new-analysis').addEventListener('click', function() {
            document.getElementById('results-section').style.display = 'none';
        });

        // API Testing functions
        document.getElementById('test-api').addEventListener('click', function() {
            alert('API test functionality would be implemented here');
        });
        
        document.getElementById('ai-analysis-btn').addEventListener('click', function() {
            alert('AI analysis functionality would be implemented here');
        });
        
        document.getElementById('save-api-key').addEventListener('click', function() {
            const apiKey = document.getElementById('api-key').value;
            if (apiKey) {
                localStorage.setItem('composition_analyzer_api_key', apiKey);
                updateApiStatus('connected', 'API: Connected (Key saved)');
                alert('API Key saved successfully!');
            } else {
                alert('Please enter an API key first!');
            }
        });

        // Save/Load Data functions
        document.getElementById('save-raw-data').addEventListener('click', function() {
            const rawMaterials = collectRawMaterialData();
            const qcData = collectQCData();
            const composition = {
                SiO2: document.getElementById('sio2').value || '',
                Al2O3: document.getElementById('al2o3').value || '',
                Fe2O3: document.getElementById('fe2o3').value || '',
                CaO: document.getElementById('cao').value || '',
                MgO: document.getElementById('mgo').value || '',
                SO3: document.getElementById('so3').value || '',
                LOI: document.getElementById('loi').value || ''
            };
            const processParams = {
                kilnInletTemp: document.getElementById('kiln-inlet-temp').value || '',
                burnZoneTemp: document.getElementById('burn-zone-temp').value || '',
                preheaterTemp: document.getElementById('preheater-temp').value || '',
                coalConsumption: document.getElementById('coal-consumption').value || '',
                freeLime: document.getElementById('free-lime').value || '',
                fineness: document.getElementById('fineness').value || ''
            };
            const targets = {
                lsf: document.getElementById('target-lsf').value || '',
                sr: document.getElementById('target-sr').value || '',
                ar: document.getElementById('target-ar').value || '',
                lsfRange: document.getElementById('target-lsf-range').value || '',
                srRange: document.getElementById('target-sr-range').value || '',
                arRange: document.getElementById('target-ar-range').value || ''
            };
            const info = {
                companyName: document.getElementById('company-name').value || '',
                reportDate: document.getElementById('report-date').value || '',
                preparedBy: document.getElementById('report-preparer').value || '',
                position: document.getElementById('report-position').value || '',
                productType: document.getElementById('product-type').value || '',
                productionDate: document.getElementById('production-date').value || '',
                notes: document.getElementById('additional-notes').value || ''
            };
            
            const saveObj = { 
                rawMaterials: rawMaterials, 
                qcData: qcData,
                composition: composition,
                processParams: processParams,
                targets: targets,
                generalInfo: info 
            };
            try {
                localStorage.setItem('compositionSavedData', JSON.stringify(saveObj));
                alert('Data saved successfully!');
            } catch (e) {
                alert('Unable to save data: ' + e.message);
            }
        });
        
        document.getElementById('load-raw-data').addEventListener('click', function() {
            const saved = localStorage.getItem('compositionSavedData');
            if (!saved) {
                alert('No saved data found.');
                return;
            }
            try {
                const data = JSON.parse(saved);
                // Populate general info
                if (data.generalInfo) {
                    document.getElementById('company-name').value = data.generalInfo.companyName || '';
                    document.getElementById('report-date').value = data.generalInfo.reportDate || '';
                    document.getElementById('report-preparer').value = data.generalInfo.preparedBy || '';
                    document.getElementById('report-position').value = data.generalInfo.position || '';
                    document.getElementById('product-type').value = data.generalInfo.productType || '';
                    document.getElementById('production-date').value = data.generalInfo.productionDate || '';
                    document.getElementById('additional-notes').value = data.generalInfo.notes || '';
                }
                // Populate composition
                if (data.composition) {
                    document.getElementById('sio2').value = data.composition.SiO2 || '';
                    document.getElementById('al2o3').value = data.composition.Al2O3 || '';
                    document.getElementById('fe2o3').value = data.composition.Fe2O3 || '';
                    document.getElementById('cao').value = data.composition.CaO || '';
                    document.getElementById('mgo').value = data.composition.MgO || '';
                    document.getElementById('so3').value = data.composition.SO3 || '';
                    document.getElementById('loi').value = data.composition.LOI || '';
                }
                // Populate process params
                if (data.processParams) {
                    document.getElementById('kiln-inlet-temp').value = data.processParams.kilnInletTemp || '';
                    document.getElementById('burn-zone-temp').value = data.processParams.burnZoneTemp || '';
                    document.getElementById('preheater-temp').value = data.processParams.preheaterTemp || '';
                    document.getElementById('coal-consumption').value = data.processParams.coalConsumption || '';
                    document.getElementById('free-lime').value = data.processParams.freeLime || '';
                    document.getElementById('fineness').value = data.processParams.fineness || '';
                }
                // Populate targets
                if (data.targets) {
                    document.getElementById('target-lsf').value = data.targets.lsf || '';
                    document.getElementById('target-sr').value = data.targets.sr || '';
                    document.getElementById('target-ar').value = data.targets.ar || '';
                    document.getElementById('target-lsf-range').value = data.targets.lsfRange || '';
                    document.getElementById('target-sr-range').value = data.targets.srRange || '';
                    document.getElementById('target-ar-range').value = data.targets.arRange || '';
                }
                // Populate raw materials
                const rawTableBody = document.getElementById('raw-material-table-body');
                rawTableBody.innerHTML = '';
                if (data.rawMaterials && data.rawMaterials.length > 0) {
                    data.rawMaterials.forEach(material => {
                        addRawMaterialRow(material.name);
                        const rows = document.querySelectorAll('#raw-material-table-body tr');
                        const lastRow = rows[rows.length - 1];
                        const inputs = lastRow.querySelectorAll('input');
                        if (inputs.length >= 5) {
                            inputs[0].value = material.name || '';
                            inputs[1].value = material.sio2 || '';
                            inputs[2].value = material.al2o3 || '';
                            inputs[3].value = material.fe2o3 || '';
                            inputs[4].value = material.cao || '';
                        }
                    });
                }
                // Populate QC data
                const qcTableBody = document.getElementById('qc-table-body');
                qcTableBody.innerHTML = '';
                if (data.qcData && data.qcData.length > 0) {
                    data.qcData.forEach(qc => {
                        addQCRow(qc.parameter, qc.result, qc.standard, qc.unit);
                    });
                }
                alert('Saved data loaded successfully.');
            } catch (e) {
                alert('Error loading saved data: ' + e.message);
            }
        });
        
        document.getElementById('load-example-raw').addEventListener('click', function() {
            // Clear existing data
            document.getElementById('raw-material-table-body').innerHTML = '';
            
            // Example data
            const exampleRawMaterials = [
                { name: 'Limestone', sio2: 4.2, al2o3: 1.1, fe2o3: 0.3, cao: 52.5 },
                { name: 'Sand', sio2: 92.0, al2o3: 4.5, fe2o3: 1.2, cao: 1.0 },
                { name: 'Clay', sio2: 55.0, al2o3: 18.0, fe2o3: 7.0, cao: 8.0 },
                { name: 'Iron Ore', sio2: 15.0, al2o3: 5.0, fe2o3: 70.0, cao: 3.0 }
            ];
            
            exampleRawMaterials.forEach(material => {
                addRawMaterialRow(material.name);
                const rows = document.querySelectorAll('#raw-material-table-body tr');
                const lastRow = rows[rows.length - 1];
                const inputs = lastRow.querySelectorAll('input[type="number"]');
                if (inputs.length >= 4) {
                    inputs[0].value = material.sio2;
                    inputs[1].value = material.al2o3;
                    inputs[2].value = material.fe2o3;
                    inputs[3].value = material.cao;
                }
            });
            
            // Fill composition data
            document.getElementById('sio2').value = '21.5';
            document.getElementById('al2o3').value = '5.8';
            document.getElementById('fe2o3').value = '3.2';
            document.getElementById('cao').value = '64.8';
            document.getElementById('mgo').value = '1.5';
            document.getElementById('so3').value = '2.1';
            document.getElementById('loi').value = '1.1';
            
            // Fill process parameters
            document.getElementById('kiln-inlet-temp').value = '850';
            document.getElementById('burn-zone-temp').value = '1450';
            document.getElementById('preheater-temp').value = '320';
            document.getElementById('coal-consumption').value = '110';
            document.getElementById('free-lime').value = '1.2';
            document.getElementById('fineness').value = '350';
            
            // Fill form fields
            document.getElementById('company-name').value = 'Asrar Cement Company';
            document.getElementById('report-preparer').value = 'Engineer Ali Ahmed';
            document.getElementById('report-position').value = 'Process Engineer';
            document.getElementById('product-type').value = 'OPC';
            document.getElementById('additional-notes').value = '• Monitor chemical composition daily\n• Check raw material consistency\n• Adjust kiln operation based on composition\n• Maintain proper LSF range for quality';
            
            alert('Example data loaded successfully! Click "Calculate Composition" to see results.');
        });

        function collectRawMaterialData() {
            const materials = [];
            const rows = document.querySelectorAll('#raw-material-table-body tr');
            rows.forEach(row => {
                const inputs = row.querySelectorAll('input');
                if (inputs.length >= 5) {
                    materials.push({
                        name: inputs[0].value,
                        sio2: parseFloat(inputs[1].value) || 0,
                        al2o3: parseFloat(inputs[2].value) || 0,
                        fe2o3: parseFloat(inputs[3].value) || 0,
                        cao: parseFloat(inputs[4].value) || 0
                    });
                }
            });
            return materials;
        }

        function collectQCData() {
            const qcData = [];
            const rows = document.querySelectorAll('#qc-table-body tr');
            rows.forEach(row => {
                const inputs = row.querySelectorAll('input');
                if (inputs.length >= 4) {
                    qcData.push({
                        parameter: inputs[0].value,
                        result: inputs[1].value,
                        standard: inputs[2].value,
                        unit: inputs[3].value
                    });
                }
            });
            return qcData;
        }
    </script>
    <script src="./common.js"></script>
</body>
</html>