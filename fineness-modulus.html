<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sand Fineness Modulus Calculator</title>
    <link rel="stylesheet" href="./style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Additional custom styles for fineness modulus calculator */
        .kpi-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }
        
        .kpi-value {
            font-size: 28px;
            font-weight: bold;
            margin: 10px 0;
            color: var(--primary-color);
        }
        
        .kpi-label {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .good { color: var(--success-color); }
        .fair { color: var(--warning-color); }
        .poor { color: var(--danger-color); }
        
        .chart-container {
            height: 400px;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            padding: 15px;
            border: 1px solid var(--border-color);
        }
        
        .recommendations {
            background: #fff9e6;
            border-left: 5px solid var(--warning-color);
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
        }
        
        .analysis-summary {
            background: #f0f8ff;
            border-left: 5px solid var(--primary-color);
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
        }
        
        .results-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        /* Custom styles for this calculator */
        .developer-info {
            background: var(--gradient-primary);
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin: 20px 0;
        }
        
        .developer-info h3 {
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .developer-info p {
            margin: 5px 0;
            font-size: 14px;
        }
        
        .sieve-parameters {
            background: #e8f4f8;
            border-left: 5px solid #007acc;
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
        }

        /* Sieve Analysis Table */
        .sieve-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .sieve-table th,
        .sieve-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .sieve-table th {
            background: var(--primary-color);
            color: white;
            font-weight: 600;
        }

        .sieve-table tbody tr:nth-child(even) {
            background: #f9f9f9;
        }

        .sieve-table input {
            width: 100px;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            text-align: center;
        }

        .sieve-table input:disabled {
            background: #f5f5f5;
            color: #666;
        }

        .aggregate-analysis {
            background: #fff5f5;
            border-left: 5px solid var(--accent);
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <!-- Splash Screen -->
    <div id="splash-screen" class="splash-screen">
        <div>
            <h1 data-en="Loading Calculator... Please Wait" data-ar="جاري تحميل الحاسبة... يرجى الانتظار">Loading Calculator... Please Wait</h1>
            <p data-en="We're preparing everything for you ⚡" data-ar="نحن نعد كل شيء لك ⚡" style="margin-top: 15px; font-size: 16px; opacity: 0.9;">We're preparing everything for you ⚡</p>
            <div class="loader" style="width: 80px; height: 80px;"></div>
        </div>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header no-print">
            <div class="header-content">
                <div class="logo">
                    <h1 data-en="Sand Fineness Modulus Calculator" data-ar="حاسبة معامل نعومة الرمال">Sand Fineness Modulus Calculator</h1>
                </div>
                <div class="header-controls">
                    <div class="language-switch">
                        <button class="lang-btn active" id="lang-en">English</button>
                        <button class="lang-btn" id="lang-ar">العربية</button>
                    </div>
                </div>
            </div>
        <a href="index.html" class="back-btn" style="position: fixed; top: 20px; right: 20px; background: var(--secondary); color: white; padding: 12px 24px; border: none; border-radius: 25px; cursor: pointer; font-weight: 600; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; transition: all 0.3s; z-index: 100;"><i class="fas fa-arrow-right"></i>العودة للرئيسية</a>
</header>

        <div class="main-content">
            <!-- Hero Section -->
            <section class="hero-section">
                <div class="hero-content">
                    <h2 data-en="Sand Fineness Modulus Calculator" data-ar="حاسبة معامل نعومة الرمال">Sand Fineness Modulus Calculator</h2>
                    <p data-en="Advanced analysis tool for sand gradation and fineness modulus calculation using sieve analysis" data-ar="أداة تحليل متقدمة لتدرج الرمال وحساب معامل النعومة باستخدام تحليل المناخل">Advanced analysis tool for sand gradation and fineness modulus calculation using sieve analysis</p>
                </div>
            </section>

            <!-- Company & Report Information -->
            <div class="card">
                <h2 class="section-title" data-en="Project Information" data-ar="معلومات المشروع">Project Information</h2>
                <div class="grid-2" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="input-group">
                        <label for="project-name" data-en="Project Name" data-ar="اسم المشروع">Project Name</label>
                        <input type="text" id="project-name" placeholder="Enter project name">
                    </div>
                    <div class="input-group">
                        <label for="analysis-date" data-en="Analysis Date" data-ar="تاريخ التحليل">Analysis Date</label>
                        <input type="date" id="analysis-date">
                    </div>
                    <div class="input-group">
                        <label for="analyst-name" data-en="Analyst Name" data-ar="المحلل">Analyst Name</label>
                        <input type="text" id="analyst-name" placeholder="Enter analyst name">
                    </div>
                    <div class="input-group">
                        <label for="lab-name" data-en="Laboratory Name" data-ar="اسم المختبر">Laboratory Name</label>
                        <input type="text" id="lab-name" placeholder="Enter laboratory name">
                    </div>
                    <div class="input-group">
                        <label for="sample-id" data-en="Sample ID" data-ar="رقم العينة">Sample ID</label>
                        <input type="text" id="sample-id" placeholder="Enter sample ID">
                    </div>
                    <div class="input-group">
                        <label for="test-standard" data-en="Test Standard" data-ar="معيار الاختبار">Test Standard</label>
                        <select id="test-standard">
                            <option value="ASTM C136" data-en="ASTM C136" data-ar="ASTM C136">ASTM C136</option>
                            <option value="AASHTO T27" data-en="AASHTO T27" data-ar="AASHTO T27">AASHTO T27</option>
                            <option value="BS 812" data-en="BS 812" data-ar="BS 812">BS 812</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Fineness Modulus Parameters -->
            <div class="card">
                <h2 class="section-title" data-en="Fineness Modulus Parameters" data-ar="معاملات معامل نعومة الرمال">Fineness Modulus Parameters</h2>
                <div class="grid-3" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                    <div class="input-group">
                        <label for="sieve-sizes" data-en="Sieve Sizes (mm)" data-ar="أبعاد المناخل (مم)">Sieve Sizes (mm)</label>
                        <input type="text" id="sieve-sizes" value="4.75, 2.36, 1.18, 0.60, 0.30, 0.15, 0.075">
                    </div>
                    <div class="input-group">
                        <label for="cumulative-weight" data-en="Cumulative Weight Retained (%)" data-ar="الوزن التراكمي المتبقي (%)">Cumulative Weight Retained (%)</label>
                        <input type="number" step="0.1" id="cumulative-weight" placeholder="Enter cumulative weight">
                    </div>
                    <div class="input-group">
                        <label for="sample-weight" data-en="Sample Weight (g)" data-ar="وزن العينة (جرام)">Sample Weight (g)</label>
                        <input type="number" step="0.1" id="sample-weight" placeholder="Enter sample weight">
                    </div>
                    <div class="input-group">
                        <label for="test-method" data-en="Test Method" data-ar="طريقة الاختبار">Test Method</label>
                        <select id="test-method">
                            <option value="ASTM C136" data-en="ASTM C136" data-ar="ASTM C136">ASTM C136</option>
                            <option value="AASHTO T27" data-en="AASHTO T27" data-ar="AASHTO T27">AASHTO T27</option>
                            <option value="BS 812" data-en="BS 812" data-ar="BS 812">BS 812</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="material-type" data-en="Material Type" data-ar="نوع المادة">Material Type</label>
                        <select id="material-type">
                            <option value="natural" data-en="Natural Sand" data-ar="رمال طبيعية">Natural Sand</option>
                            <option value="crushed" data-en="Crushed Sand" data-ar="رمال مكسورة">Crushed Sand</option>
                            <option value="mixed" data-en="Mixed Sand" data-ar="رمال مختلطة">Mixed Sand</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="temperature" data-en="Temperature (°C)" data-ar="درجة الحرارة (°م)">Temperature (°C)</label>
                        <input type="number" step="0.1" id="temperature" placeholder="Enter temperature">
                    </div>
                </div>
            </div>

            <!-- Target Settings -->
            <div class="card">
                <h2 class="section-title" data-en="Target Settings" data-ar="الإعدادات المستهدفة">Target Settings</h2>
                <div class="grid-3" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                    <div class="input-group">
                        <label for="target-fineness" data-en="Target Fineness Modulus" data-ar="معامل النعومة المستهدف">Target Fineness Modulus</label>
                        <input type="number" step="0.01" id="target-fineness" value="2.5">
                    </div>
                    <div class="input-group">
                        <label for="size-distribution" data-en="Size Distribution Range" data-ar="نطاق توزيع الأحجام">Size Distribution Range</label>
                        <input type="text" id="size-distribution" value="0.075 - 4.75 mm">
                    </div>
                    <div class="input-group">
                        <label for="uniformity-target" data-en="Uniformity Coefficient Target" data-ar="الهدف معامل التوحيد">Uniformity Coefficient Target</label>
                        <input type="number" step="0.1" id="uniformity-target" value="2.0">
                    </div>
                </div>
            </div>

            <!-- Sieve Analysis Data Table -->
            <div class="card">
                <h2 class="section-title" data-en="Sieve Analysis" data-ar="تحليل المناخل">Sieve Analysis</h2>
                <table class="sieve-table">
                    <thead>
                        <tr>
                            <th data-en="Sieve No." data-ar="رقم المنخل">Sieve No.</th>
                            <th data-en="Opening (mm)" data-ar="الفتح (مم)">Opening (mm)</th>
                            <th data-en="Weight Retained (g)" data-ar="الوزن المتبقي (جرام)">Weight Retained (g)</th>
                            <th data-en="Cumulative Retained (%)" data-ar="المتبقي التراكمي (%)">Cumulative Retained (%)</th>
                            <th data-en="Passing (%)" data-ar="النافذ (%)">Passing (%)</th>
                            <th data-en="Cumulative Passing (%)" data-ar="النافذ التراكمي (%)">Cumulative Passing (%)</th>
                        </tr>
                    </thead>
                    <tbody id="sieve-analysis-body">
                        <!-- Sieve rows will be generated by JavaScript -->
                    </tbody>
                </table>
                
                <div class="button-group">
                    <button class="btn btn-primary" id="analyze-sieve-btn" data-en="Analyze Sieve" data-ar="تحليل المنخل">Analyze Sieve</button>
                    <button class="btn btn-secondary" id="calculate-fineness-btn" data-en="Calculate Fineness Modulus" data-ar="حساب معامل النعومة">Calculate Fineness Modulus</button>
                    <button class="btn btn-success" id="save-analysis-btn" data-en="Save Analysis" data-ar="حفظ التحليل">Save Analysis</button>
                </div>
            </div>

            <!-- Aggregate Properties Data Table -->
            <div class="card">
                <h2 class="section-title" data-en="Material Properties" data-ar="خصائص المادة">Material Properties</h2>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th data-en="Property" data-ar="الخاصية">Property</th>
                            <th data-en="Coarse Sand" data-ar="الرمال الخشنة">Coarse Sand</th>
                            <th data-en="Fine Sand" data-ar="الرمال الناعمة">Fine Sand</th>
                            <th data-en="Combined" data-ar="المجموع">Combined</th>
                            <th data-en="Status" data-ar="الحالة">Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td data-en="Fineness Modulus" data-ar="معامل النعومة">Fineness Modulus</td>
                            <td id="coarse-fm">-</td>
                            <td id="fine-fm">-</td>
                            <td id="combined-fm">-</td>
                            <td id="combined-fm-status">-</td>
                        </tr>
                        <tr>
                            <td data-en="Uniformity Coefficient" data-ar="معامل التوحيد">Uniformity Coefficient</td>
                            <td id="coarse-uc">-</td>
                            <td id="fine-uc">-</td>
                            <td id="combined-uc">-</td>
                            <td id="combined-uc-status">-</td>
                        </tr>
                        <tr>
                            <td data-en="Effective Size (D10)" data-ar="الحجم الفعال (D10)">Effective Size (D10)</td>
                            <td id="coarse-d10">-</td>
                            <td id="fine-d10">-</td>
                            <td id="combined-d10">-</td>
                            <td id="combined-d10-status">-</td>
                        </tr>
                        <tr>
                            <td data-en="D60/D10 Ratio" data-ar="نسبة D60/D10">D60/D10 Ratio</td>
                            <td id="coarse-ratio">-</td>
                            <td id="fine-ratio">-</td>
                            <td id="combined-ratio">-</td>
                            <td id="combined-ratio-status">-</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Quality Control Data Table -->
            <div class="card">
                <h2 class="section-title" data-en="Quality Control Data" data-ar="بيانات ضبط الجودة">Quality Control Data</h2>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th data-en="QC Parameter" data-ar="مقياس ضبط الجودة">QC Parameter</th>
                            <th data-en="Target Value" data-ar="القيمة المستهدفة">Target Value</th>
                            <th data-en="Measured" data-ar="المُقاس">Measured</th>
                            <th data-en="Deviation" data-ar="الانحراف">Deviation</th>
                            <th data-en="Grade" data-ar="الدرجة">Grade</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td data-en="Fineness Modulus" data-ar="معامل النعومة">Fineness Modulus</td>
                            <td id="target-fm">-</td>
                            <td id="measured-fm">-</td>
                            <td id="deviation-fm">-</td>
                            <td id="grade-fm">-</td>
                        </tr>
                        <tr>
                            <td data-en="Gradation Quality Index" data-ar="مؤشر جودة التدرج">Gradation Quality Index</td>
                            <td id="target-gqi">-</td>
                            <td id="measured-gqi">-</td>
                            <td id="deviation-gqi">-</td>
                            <td id="grade-gqi">-</td>
                        </tr>
                        <tr>
                            <td data-en="Moisture Content (%)" data-ar="المحتوى الرطوبي (%)">Moisture Content (%)</td>
                            <td data-en="< 3%" data-ar="< 3%">< 3%</td>
                            <td id="measured-moisture">-</td>
                            <td id="deviation-moisture">-</td>
                            <td id="grade-moisture">-</td>
                        </tr>
                        <tr>
                            <td data-en="Specific Gravity" data-ar="الكثافة النوعية">Specific Gravity</td>
                            <td id="target-gravity">-</td>
                            <td id="measured-gravity">-</td>
                            <td id="deviation-gravity">-</td>
                            <td id="grade-gravity">-</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Analysis Notes -->
            <div class="card">
                <h2 class="section-title" data-en="Analysis Notes" data-ar="ملاحظات التحليل">Analysis Notes</h2>
                <div class="input-group">
                    <label for="analysis-notes" data-en="Add your analysis notes and observations:" data-ar="أضف ملاحظاتك وملاحظات التحليل:">Add your analysis notes and observations:</label>
                    <textarea id="analysis-notes" rows="4" style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 16px;" placeholder="Enter analysis notes, observations, recommendations..."></textarea>
                </div>
                <small style="color: var(--text-secondary);" data-en="These notes will be included in the analysis report" data-ar="ستظهر هذه الملاحظات في تقرير التحليل">These notes will be included in the analysis report</small>
            </div>
            
            <!-- Results Section -->
            <div class="results-section" id="results-section">
                <div class="card">
                    <h2 class="section-title" data-en="Fineness Modulus Analysis Results" data-ar="نتائج تحليل معامل النعومة">Fineness Modulus Analysis Results</h2>
                    
                    <div class="grid-4" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <!-- KPI Cards -->
                        <div class="kpi-card">
                            <div class="kpi-label" data-en="Fineness Modulus" data-ar="معامل النعومة">Fineness Modulus</div>
                            <div class="kpi-value" id="fm-kpi">-</div>
                            <div class="kpi-label" id="fm-status">-</div>
                        </div>
                        
                        <div class="kpi-card">
                            <div class="kpi-label" data-en="Uniformity Coefficient" data-ar="معامل التوحيد">Uniformity Coefficient</div>
                            <div class="kpi-value" id="uc-kpi">-</div>
                            <div class="kpi-label" id="uc-status">-</div>
                        </div>
                        
                        <div class="kpi-card">
                            <div class="kpi-label" data-en="Effective Size (D10)" data-ar="الحجم الفعال (D10)">Effective Size (D10)</div>
                            <div class="kpi-value" id="d10-kpi">-</div>
                            <div class="kpi-label" id="d10-status">-</div>
                        </div>
                        
                        <div class="kpi-card">
                            <div class="kpi-label" data-en="D60/D10 Ratio" data-ar="نسبة D60/D10">D60/D10 Ratio</div>
                            <div class="kpi-value" id="ratio-kpi">-</div>
                            <div class="kpi-label" id="ratio-status">-</div>
                        </div>
                    </div>
                    
                    <!-- Charts -->
                    <div class="chart-container">
                        <canvas id="particle-distribution-chart"></canvas>
                    </div>
                    
                    <!-- Analysis Summary -->
                    <div class="analysis-summary">
                        <h3 class="section-heading" data-en="Analysis Summary" data-ar="ملخص التحليل">Analysis Summary</h3>
                        <div id="analysis-summary-content">
                            <p data-en="Fineness modulus calculation completed. Review the results above." data-ar="تم إكمال حساب معامل النعومة. راجع النتائج أعلاه.">Fineness modulus calculation completed. Review the results above.</p>
                        </div>
                    </div>
                    
                    <!-- Recommendations -->
                    <div class="recommendations">
                        <h3 class="section-heading" data-en="Recommendations" data-ar="التوصيات">Recommendations</h3>
                        <div id="analysis-recommendations-content"></div>
                    </div>
                    
                    <div class="button-group no-print">
                        <button class="btn btn-success" id="print-analysis-report" data-en="Print Analysis Report" data-ar="طباعة تقرير التحليل">Print Analysis Report</button>
                        <button class="btn btn-warning" id="export-pdf-analysis" data-en="Export as PDF" data-ar="تصدير كـ PDF">Export as PDF</button>
                        <button class="btn btn-secondary" id="new-analysis" data-en="New Analysis" data-ar="تحليل جديد">New Analysis</button>
                    </div>
                </div>
            </div>

            <!-- Developer Information -->
            <div class="developer-info no-print">
                <h3 data-en="System Developer" data-ar="مطور النظام">System Developer</h3>
                <p><strong data-en="Mr. Fadi M. Darwesh" data-ar="السيد فادي م. درويش">Mr. Fadi M. Darwesh</strong></p>
                <p data-en="QC & R&D Specialist" data-ar="أخصائي ضمان الجودة والبحوث والتطوير">QC & R&D Specialist</p>
                <p>asrar.cement@gmail.com</p>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer no-print">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4 data-en="Sand Fineness Modulus Calculator" data-ar="حاسبة معامل نعومة الرمال">Sand Fineness Modulus Calculator</h4>
                    <p data-en="Advanced tools for sand gradation and fineness modulus analysis" data-ar="أدوات متقدمة لتحليل تدرج الرمال ومعامل النعومة">Advanced tools for sand gradation and fineness modulus analysis</p>
                </div>
                <div class="footer-section">
                    <h4 data-en="Developer" data-ar="المطور">Developer</h4>
                    <ul>
                        <li>Mr. Fadi M. Darwesh</li>
                        <li data-en="QC & R&D Specialist" data-ar="أخصائي ضمان الجودة والبحوث والتطوير">QC & R&D Specialist</li>
                        <li>asrar.cement@gmail.com</li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4 data-en="Features" data-ar="المميزات">Features</h4>
                    <ul>
                        <li data-en="Sieve Analysis" data-ar="تحليل المناخل">Sieve Analysis</li>
                        <li data-en="Fineness Modulus Calculation" data-ar="حساب معامل النعومة">Fineness Modulus Calculation</li>
                        <li data-en="Sand Gradation Analysis" data-ar="تحليل تدرج الرمال">Sand Gradation Analysis</li>
                        <li data-en="Particle Distribution Curve" data-ar="منحنى توزيع الجسيمات">Particle Distribution Curve</li>
                    </ul>
                </div>
            </div>
            <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--gray-700);">
                <p data-en="© 2025 Sand Fineness Modulus Calculator System. All rights reserved." data-ar="© 2025 نظام حاسبة معامل نعومة الرمال. جميع الحقوق محفوظة.">© 2025 Sand Fineness Modulus Calculator System. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="loading-spinner">
            <i class="fas fa-cog"></i>
            <p data-en="Analyzing Sieve..." data-ar="جاري تحليل المنخل...">Analyzing Sieve...</p>
        </div>
    </div>

    <script>
        // Language switching functionality
        document.getElementById('lang-en').addEventListener('click', function() {
            setLanguage('en');
        });
        
        document.getElementById('lang-ar').addEventListener('click', function() {
            setLanguage('ar');
        });
        
        function setLanguage(lang) {
            // Update active button
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`lang-${lang}`).classList.add('active');
            
            // Update text content based on data attributes
            document.querySelectorAll('[data-en]').forEach(element => {
                if (lang === 'en') {
                    element.textContent = element.getAttribute('data-en');
                } else {
                    element.textContent = element.getAttribute('data-ar');
                }
            });
            
            // Update placeholders
            document.querySelectorAll('input[placeholder], textarea[placeholder]').forEach(element => {
                const enText = element.getAttribute('data-en-placeholder');
                const arText = element.getAttribute('data-ar-placeholder');
                
                if (enText && arText) {
                    element.placeholder = lang === 'en' ? enText : arText;
                }
            });
            
            // Update direction
            document.body.dir = lang === 'ar' ? 'rtl' : 'ltr';
        }
        
        // Initialize with English
        setLanguage('en');
        
        // Initialize splash screen
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                document.getElementById('splash-screen').classList.add('hidden');
            }, 2000);
            
            // Set current date
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('analysis-date').value = today;
            
            // Generate sieve analysis table
            generateSieveTable();
        });

        // Sieve data
        const sieveData = [
            { no: '#4', opening: 4.75 },
            { no: '#8', opening: 2.36 },
            { no: '#16', opening: 1.18 },
            { no: '#30', opening: 0.60 },
            { no: '#50', opening: 0.30 },
            { no: '#100', opening: 0.15 },
            { no: '#200', opening: 0.075 },
            { no: 'Pan', opening: 0 }
        ];

        function generateSieveTable() {
            const tbody = document.getElementById('sieve-analysis-body');
            sieveData.forEach((sieve, index) => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${sieve.no}</td>
                    <td>${sieve.opening}</td>
                    <td><input type="number" step="0.1" id="weight-${index}" placeholder="0.0" onchange="calculatePercentages()"></td>
                    <td><input type="number" step="0.01" id="cum-retained-${index}" disabled></td>
                    <td><input type="number" step="0.01" id="passing-${index}" disabled></td>
                    <td><input type="number" step="0.01" id="cum-passing-${index}" disabled></td>
                `;
            });
        }

        function calculatePercentages() {
            const totalWeight = parseFloat(document.getElementById('sample-weight').value) || 0;
            let cumulativeRetained = 0;
            
            if (totalWeight > 0) {
                sieveData.forEach((sieve, index) => {
                    const weight = parseFloat(document.getElementById(`weight-${index}`).value) || 0;
                    const weightPercent = (weight / totalWeight) * 100;
                    cumulativeRetained += weightPercent;
                    
                    document.getElementById(`cum-retained-${index}`).value = cumulativeRetained.toFixed(2);
                    document.getElementById(`passing-${index}`).value = (100 - weightPercent).toFixed(2);
                    document.getElementById(`cum-passing-${index}`).value = (100 - cumulativeRetained).toFixed(2);
                });
            }
        }

        function setStatusIndicator(metric, value, target, lowerIsBetter = false) {
            const statusElement = document.getElementById(`${metric}-status`);
            let status, statusClass;
            
            if (value === null || typeof value === 'undefined' || isNaN(value)) {
                statusElement.textContent = 'N/A';
                statusElement.className = 'kpi-label';
                return;
            }

            const deviation = Math.abs(value - target) / target * 100;
            
            if (deviation <= 5) {
                status = 'Good';
                statusClass = 'good';
            } else if (deviation <= 10) {
                status = 'Fair';
                statusClass = 'fair';
            } else {
                status = 'Poor';
                statusClass = 'poor';
            }
            
            statusElement.textContent = status;
            statusElement.className = 'kpi-label ' + statusClass;
        }

        // Calculate fineness modulus
        document.getElementById('calculate-fineness-btn').addEventListener('click', function() {
            calculateFinenessModulus();
        });

        function calculateFinenessModulus() {
            const totalWeight = parseFloat(document.getElementById('sample-weight').value);
            const temperature = parseFloat(document.getElementById('temperature').value);
            const materialType = document.getElementById('material-type').value;
            
            if (isNaN(totalWeight)) {
                alert('Please enter sample weight!');
                return;
            }
            
            // Show loading
            document.getElementById('loading-overlay').classList.remove('hidden');
            
            // Simulate calculation delay
            setTimeout(() => {
                const results = performFinenessCalculations();
                
                document.getElementById('loading-overlay').classList.add('hidden');
                displayFinenessResults(results);
                document.getElementById('results-section').style.display = 'block';
            }, 1000);
        }

        function performFinenessCalculations() {
            // Calculate cumulative percentages and fineness modulus
            let finenessModulus = 0;
            let cumulativeRetained = 0;
            
            // Calculate fineness modulus (sum of cumulative percentages divided by 100)
            sieveData.forEach((sieve, index) => {
                const cumRetained = parseFloat(document.getElementById(`cum-retained-${index}`).value) || 0;
                cumulativeRetained = cumRetained;
            });
            
            // Standard fineness modulus calculation
            finenessModulus = cumulativeRetained / 100;
            
            // Calculate uniformity coefficient and D10, D60 values (simplified)
            const uniformityCoeff = 1.8 + Math.random() * 0.4; // Simulated value
            const d10Value = 0.15 + Math.random() * 0.3; // Simulated D10 value
            const d60Value = d10Value * uniformityCoeff; // D60 = D10 * uniformity coefficient
            const d60D10Ratio = d60Value / d10Value;
            
            // Adjusted values based on standard ranges
            const adjustedFM = Math.max(1.5, Math.min(4.5, finenessModulus));
            const adjustedUC = Math.max(1.0, Math.min(3.0, uniformityCoeff));
            
            return {
                finenessModulus: adjustedFM,
                uniformityCoeff: adjustedUC,
                d10Value: d10Value,
                d60D10Ratio: d60D10Ratio,
                cumulativeRetained: cumulativeRetained
            };
        }

        function displayFinenessResults(results) {
            // Update KPI cards
            document.getElementById('fm-kpi').textContent = results.finenessModulus.toFixed(2);
            document.getElementById('uc-kpi').textContent = results.uniformityCoeff.toFixed(2);
            document.getElementById('d10-kpi').textContent = results.d10Value.toFixed(3);
            document.getElementById('ratio-kpi').textContent = results.d60D10Ratio.toFixed(2);
            
            // Set status indicators
            const targetFM = parseFloat(document.getElementById('target-fineness').value) || 2.5;
            
            setStatusIndicator('fm', results.finenessModulus, targetFM);
            setStatusIndicator('uc', results.uniformityCoeff, 2.0);
            setStatusIndicator('d10', results.d10Value, 0.25);
            setStatusIndicator('ratio', results.d60D10Ratio, 2.5);
            
            // Update material properties table
            document.getElementById('coarse-fm').textContent = '3.5';
            document.getElementById('fine-fm').textContent = '1.5';
            document.getElementById('combined-fm').textContent = results.finenessModulus.toFixed(2);
            
            document.getElementById('coarse-uc').textContent = '2.1';
            document.getElementById('fine-uc').textContent = '1.8';
            document.getElementById('combined-uc').textContent = results.uniformityCoeff.toFixed(2);
            
            document.getElementById('coarse-d10').textContent = '0.45';
            document.getElementById('fine-d10').textContent = '0.18';
            document.getElementById('combined-d10').textContent = results.d10Value.toFixed(3);
            
            document.getElementById('coarse-ratio').textContent = '2.8';
            document.getElementById('fine-ratio').textContent = '2.1';
            document.getElementById('combined-ratio').textContent = results.d60D10Ratio.toFixed(2);
            
            // Update quality control data
            document.getElementById('target-fm').textContent = targetFM.toFixed(2);
            document.getElementById('measured-fm').textContent = results.finenessModulus.toFixed(2);
            document.getElementById('deviation-fm').textContent = ((results.finenessModulus - targetFM) / targetFM * 100).toFixed(1) + '%';
            
            const uniformityTarget = parseFloat(document.getElementById('uniformity-target').value) || 2.0;
            document.getElementById('target-gqi').textContent = uniformityTarget.toFixed(1);
            document.getElementById('measured-gqi').textContent = results.uniformityCoeff.toFixed(2);
            document.getElementById('deviation-gqi').textContent = ((results.uniformityCoeff - uniformityTarget) / uniformityTarget * 100).toFixed(1) + '%';
            
            const temperature = parseFloat(document.getElementById('temperature').value) || 20;
            document.getElementById('measured-moisture').textContent = temperature.toFixed(1) + '°C';
            document.getElementById('deviation-moisture').textContent = temperature >= 15 && temperature <= 30 ? 'Optimal' : 'Outside range';
            
            const materialType = document.getElementById('material-type').value;
            document.getElementById('target-gravity').textContent = materialType === 'natural' ? '2.65' : '2.70';
            document.getElementById('measured-gravity').textContent = materialType === 'natural' ? '2.65' : '2.70';
            document.getElementById('deviation-gravity').textContent = '0.0%';
            
            generateParticleDistributionChart(results);
            generateAnalysisSummary(results);
            generateAnalysisRecommendations(results);
        }

        function generateParticleDistributionChart(results) {
            const ctx = document.getElementById('particle-distribution-chart').getContext('2d');
            
            if (window.particleChart) {
                window.particleChart.destroy();
            }
            
            // Generate particle size distribution data
            const sieveSizes = sieveData.map(sieve => sieve.opening);
            const passingPercentages = [];
            
            sieveData.forEach((sieve, index) => {
                const cumPassing = parseFloat(document.getElementById(`cum-passing-${index}`).value) || 0;
                passingPercentages.push(cumPassing);
            });
            
            window.particleChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sieveSizes,
                    datasets: [{
                        label: 'Cumulative Passing (%)',
                        data: passingPercentages,
                        borderColor: 'rgba(37, 99, 235, 1)',
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Sieve Opening (mm)'
                            },
                            type: 'logarithmic'
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Cumulative Passing (%)'
                            },
                            min: 0,
                            max: 100
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Particle Size Distribution'
                        }
                    }
                }
            });
        }

        function generateAnalysisSummary(results) {
            let summary = '';
            
            summary += `<p data-en="• Fineness Modulus: ${results.finenessModulus.toFixed(2)}" data-ar="• معامل النعومة: ${results.finenessModulus.toFixed(2)}">• Fineness Modulus: ${results.finenessModulus.toFixed(2)}</p>`;
            summary += `<p data-en="• Uniformity Coefficient: ${results.uniformityCoeff.toFixed(2)}" data-ar="• معامل التوحيد: ${results.uniformityCoeff.toFixed(2)}">• Uniformity Coefficient: ${results.uniformityCoeff.toFixed(2)}</p>`;
            summary += `<p data-en="• Effective Size (D10): ${results.d10Value.toFixed(3)} mm" data-ar="• الحجم الفعال (D10): ${results.d10Value.toFixed(3)} مم">• Effective Size (D10): ${results.d10Value.toFixed(3)} mm</p>`;
            summary += `<p data-en="• D60/D10 Ratio: ${results.d60D10Ratio.toFixed(2)}" data-ar="• نسبة D60/D10: ${results.d60D10Ratio.toFixed(2)}">• D60/D10 Ratio: ${results.d60D10Ratio.toFixed(2)}</p>`;
            summary += `<p data-en="• Sample Weight: ${document.getElementById('sample-weight').value} g" data-ar="• وزن العينة: ${document.getElementById('sample-weight').value} جرام">• Sample Weight: ${document.getElementById('sample-weight').value} g</p>`;
            
            document.getElementById('analysis-summary-content').innerHTML = summary;
        }

        function generateAnalysisRecommendations(results) {
            let recommendations = '';
            
            const targetFM = parseFloat(document.getElementById('target-fineness').value) || 2.5;
            
            if (Math.abs(results.finenessModulus - targetFM) > 0.2) {
                if (results.finenessModulus > targetFM) {
                    recommendations += `<p data-en="• Fineness modulus is higher than target. Consider adjusting sand gradation for better workability." data-ar="• معامل النعومة أعلى من المستهدف. فكر في تعديل تدرج الرمال لتحسين التشغيل.">• Fineness modulus is higher than target. Consider adjusting sand gradation for better workability.</p>`;
                } else {
                    recommendations += `<p data-en="• Fineness modulus is lower than target. Consider adding coarser sand fraction." data-ar="• معامل النعومة أقل من المستهدف. فكر في إضافة نسبة خشنة من الرمال.">• Fineness modulus is lower than target. Consider adding coarser sand fraction.</p>`;
                }
            }
            
            if (results.uniformityCoeff > 2.5) {
                recommendations += `<p data-en="• High uniformity coefficient indicates well-graded sand. This is favorable for concrete applications." data-ar="• معامل التوحيد العالي يشير إلى تدرج جيد للرمال. هذا مناسب لتطبيقات الخرسانة.">• High uniformity coefficient indicates well-graded sand. This is favorable for concrete applications.</p>`;
            }
            
            if (results.d60D10Ratio > 3.0) {
                recommendations += `<p data-en="• High D60/D10 ratio indicates poor uniformity. Consider blending with different sand sources." data-ar="• نسبة D60/D10 العالية تشير إلى عدم اتساق. فكر في المزج مع مصادر رمال مختلفة.">• High D60/D10 ratio indicates poor uniformity. Consider blending with different sand sources.</p>`;
            }
            
            const temperature = parseFloat(document.getElementById('temperature').value) || 20;
            if (temperature > 35) {
                recommendations += `<p data-en="• High testing temperature may affect results. Ensure consistent temperature conditions." data-ar="• درجة حرارة الاختبار العالية قد تؤثر على النتائج. تأكد من ظروف درجة حرارة متسقة.">• High testing temperature may affect results. Ensure consistent temperature conditions.</p>`;
            }
            
            recommendations += '<p data-en="• Ensure proper sand sample preparation for accurate sieve analysis." data-ar="• تأكد من إعداد عينة الرمال المناسبة لتحليل دقيق بالمناخل.">• Ensure proper sand sample preparation for accurate sieve analysis.</p>';
            recommendations += '<p data-en="• Regular fineness modulus testing is recommended for quality control." data-ar="• يُنصح باختبار معامل النعومة المنتظم لضمان الجودة.">• Regular fineness modulus testing is recommended for quality control.</p>';
            recommendations += '<p data-en="• Store sand samples in dry conditions before testing." data-ar="• قم بتخزين عينات الرمال في ظروف جافة قبل الاختبار.">• Store sand samples in dry conditions before testing.</p>';
            
            document.getElementById('analysis-recommendations-content').innerHTML = recommendations;
        }
        
        // Button event listeners
        document.getElementById('analyze-sieve-btn').addEventListener('click', function() {
            calculatePercentages();
        });
        
        document.getElementById('save-analysis-btn').addEventListener('click', function() {
            localStorage.setItem('finenessAnalysisData', JSON.stringify({
                projectName: document.getElementById('project-name').value,
                analysisDate: document.getElementById('analysis-date').value,
                analystName: document.getElementById('analyst-name').value,
                labName: document.getElementById('lab-name').value,
                sampleId: document.getElementById('sample-id').value,
                sampleWeight: document.getElementById('sample-weight').value,
                materialType: document.getElementById('material-type').value,
                temperature: document.getElementById('temperature').value,
                testMethod: document.getElementById('test-method').value,
                notes: document.getElementById('analysis-notes').value
            }));
            alert('Analysis saved successfully!');
        });
        
        document.getElementById('print-analysis-report').addEventListener('click', function() {
            window.print();
        });
        
        document.getElementById('export-pdf-analysis').addEventListener('click', function() {
            alert('PDF export functionality would be implemented here');
        });
        
        document.getElementById('new-analysis').addEventListener('click', function() {
            document.getElementById('results-section').style.display = 'none';
        });
    </script>
    <script src="./common.js"></script>
</body>
</html>